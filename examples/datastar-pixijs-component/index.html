<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datastar WC + Auto Server Mangling</title>
    <!-- Datastar JS -->
    <script type="module" src="https://cdn.jsdelivr.net/gh/starfederation/datastar@v1.0.0-beta.11/bundles/datastar.js"></script>
    <!-- PixiJS (Dependency for components) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/8.6.6/pixi.min.js" referrerpolicy="no-referrer"></script>
    <!-- Web Component JS -->
    <script type="module" src="/static/js/reverse-component.js"></script>
    <script type="module" src="/static/js/pixi-mangled-text.js"></script> <!-- Include the new component -->
    <!-- Basic Styling -->
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
     <style> /* Basic loading indicator */
        .loading-dots { opacity:0; transition: opacity 200ms ease-out; }
        .loading-dots.loading { opacity:1; transition: opacity 200ms ease-in; }
        .loading-dots::after { content: ' .'; animation: loading-dots 1s steps(5, end) infinite; }
        @keyframes loading-dots { 0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);} 40% { color: inherit; text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);} 60% { text-shadow: .25em 0 0, .5em 0 0 rgba(0,0,0,0);} 80%, 100% { text-shadow: .25em 0 0, .5em 0 0;} }
    </style>
</head>
<body class="p-8 font-sans">

    <h1 class="text-2xl font-bold mb-4">Datastar: Auto Server Mangling</h1>

    <!-- Datastar container: Initialize ALL signals -->
    <div data-signals="{name:'', reversed:'', mangledText: '', fetching: false}" class="flex flex-col gap-4 max-w-md">

        <!-- Input bound to $name signal -->
        <!-- !!! ADDED data-on-input and data-indicator !!! -->
        <div>
            <label for="name-input" class="block text-sm font-medium text-gray-700">Enter Text:</label>
            <input
                id="name-input"
                data-bind-name
                data-on-input__debounce.100ms="$name.trim() && @get('/mangle-text')" /* Send after 500ms pause if not empty */
                data-indicator-fetching /* Link loading state to this input's action */
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"
                placeholder="Text to process (auto-mangles on pause)"
            />
        </div>

        <!-- Web Component for Client-Side Reversing (Unchanged) -->
        <div class="p-4 border border-blue-300 rounded-md">
            <h2 class="text-lg font-semibold text-blue-700 mb-2">Client-Side (Web Component)</h2>
            <label class="block text-sm font-medium text-gray-700">Reversed Text:</label>
            <div class="mt-1 p-2 min-h-[30px] bg-blue-50 rounded-md">
                <span data-text="$reversed" class="font-mono text-blue-900"></span>
            </div>
            <reverse-component
                data-attr-name="$name"
                data-on-reverse="$reversed = evt.detail.value"
            ></reverse-component>
        </div>

        <!-- Server-Side Mangling Section -->
        <div class="p-4 border border-green-300 rounded-md">
            <h2 class="text-lg font-semibold text-green-700 mb-2">Server-Side (Go Backend)</h2>
             <div class="flex items-center gap-4">
                 <!-- !!! REMOVED Mangle Button !!! -->
                 <div class="loading-dots text-green-600" data-class="{'loading': $fetching}">Loading Server Response</div>
             </div>
            <label class="mt-4 block text-sm font-medium text-gray-700">Mangled Text:</label>
            <div class="mt-1 p-2 min-h-[30px] bg-green-50 rounded-md">
                <span data-text="$mangledText" class="font-mono text-green-900 break-all"></span>
            </div>
        </div>

        <!-- Server-Side Mangling Section PIXI -->
        <div class="p-4 border border-green-300 rounded-md">
            <h2 class="text-lg font-semibold text-green-700 mb-2">Server-Side (Go Backend + Pixi Display)</h2>
             <div class="flex items-center gap-4">
                 <div class="loading-dots text-green-600" data-class="{'loading': $fetching}">Loading Server Response</div>
             </div>
            <label class="mt-4 block text-sm font-medium text-gray-700">Mangled Text (rendered by PixiJS):</label>
            <div class="mt-1">
                 <pixi-mangled-text
                    data-attr-text-content="$mangledText" 
                 ></pixi-mangled-text>
            </div>
        </div>

    </div>

</body>
</html>